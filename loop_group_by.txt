Loop com group by:
 
LOOP AT lt_vbap ASSIGNING FIELD-SYMBOL(<fs_prcd_elements>)
                    GROUP BY ( vbeln = <fs_prcd_elements>-vbeln )
                    ASCENDING
                    ASSIGNING FIELD-SYMBOL(<group>).
      LOOP AT GROUP <group> ASSIGNING FIELD-SYMBOL(<fs_group>).
        CASE <fs_group>-kschl.
          WHEN 'ICMI'.
            ls_vendas-preco-valor-liquido += <fs_group>-kbetr.
          WHEN 'PR00'.
            ls_vendas-preco-valor-bruto += <fs_group>-kbetr.
          WHEN 'BX13'.
            ls_vendas-preco-icms-aliq += <fs_group>-kbetr.
          WHEN 'BX13'.
            ls_vendas-preco-icms-valor += <fs_group>-kbetr.
          WHEN OTHERS.
        ENDCASE.
        ls_vendas-codestab = lc_1003.
        ls_vendas-codprod  = <fs_prcd_elements>-matnr.
        ls_vendas-dt       = <fs_prcd_elements>-fkdat_ana.
        ls_vendas-qt       = <fs_prcd_elements>-kwmeng.
      ENDLOOP.
      APPEND ls_vendas TO rs_result-vendas.
      CLEAR ls_vendas.
    ENDLOOP.